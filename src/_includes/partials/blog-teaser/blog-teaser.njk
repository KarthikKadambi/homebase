<section class="blog-teaser" aria-label="{{ ariaLabel | default(heading | default('Featured blog posts')) }}">
  <h2 class="blog-teaser__heading">{{ heading | default('Featured posts') }}</h2>
  {%- if subheading -%}
    <p class="blog-teaser__subheading">{{ subheading }}</p>
  {%- endif -%}

  {# Ensure we use the Eleventy "collections" global and have sensible defaults #}
  {%- set collectionName = collectionName | default('posts') -%}
  {%- set posts = (collections[collectionName] | default([])) | reverse -%}

  <div class="grid three-columns" data-layout="thirds">{% for post in posts -%}
    <article class="flow | blog-teaser__article">
        {%- set titleText = post.data.title | default('') -%}
        {%- set parts = titleText.split('|') -%}
        <h3 class="blog-teaser__article-heading"><a href="{{ post.url }}">
          {%- if parts.length > 0 and parts[0] -%}
            {{- parts[0] | trim -}}
          {%- else -%}
            {{- titleText | trim -}}
          {%- endif -%}
        </a></h3>
        {%- set teaser = post.templateContent | striptags | truncate(125, false, '...') -%}
        <p>{{- teaser -}}</p>
    </article>{%- endfor %}
  </div>
</section>