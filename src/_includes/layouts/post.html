---
layout: 'layouts/base.html'
---
<article>
    {%- set parts = title.split('|') -%}
    {%- if parts.length > 1 -%}
      <h1 class="header-branding">{{- parts[0] | trim -}}</h1>
      {%- set sub = parts[1] | trim -%}
      {%- if sub -%}
        <h2 class="header-sub">{{- sub -}}</h2>
      {%- endif -%}
    {%- else -%}
      <h1 class="header-branding">{{- title | trim -}}</h1>
    {%- endif -%}

  {{ content | safe }}
  {% if notes %}
    <section class="related-notes">
      <h3>Related Notes</h3>
      <ul>
        {% for slug in notes %}
          {% set note = collections.notes | findNoteBySlug(slug) %}
          {% if note %}
            <li><a href="{{ note.url }}">{{ note.data.title }}</a></li>
          {% endif %}
        {% endfor %}
      </ul>
    </section>
  {% else %}
    {# Optional fallback: link by shared tags #}
    {% set related = [] %}
    {% for note in collections.notes %}
      {% if note.data.tags | intersect(page.tags) | length %}
        {% set related = related | push(note) %}
      {% endif %}
    {% endfor %}

    {% if related.length %}
      <section class="related-notes">
        <h3>Notes with similar topics</h3>
        <ul>
          {% for note in related %}
            <li><a href="{{ note.url }}">{{ note.data.title }}</a></li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}
  {% endif %}
</article>

{% set canonical = "https://karthikkadambi.com" ~ page.url %}
{% include 'partials/webmentions/webmentions.njk' %}
{% if contentScript %}
  <script src="{{ contentScript }}" defer></script>
{% endif %}